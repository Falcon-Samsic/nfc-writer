<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>AEP Registration</title>
</head>
<body>
  <h2 align:"center">Register New AEP:</h2>
  <p id="display">Preparing…</p>
  <button id="writeBtn">Tap to Register</button>

  <script>
    // Grab the “val” param as before
    const params = new URLSearchParams(location.search);
    const val    = params.get('val') || '';
    document.getElementById('display')
            .textContent = `Value → ${val}`;

    // Feature-detect Web NFC
    if (!('NDEFReader' in window)) {
      document.getElementById('display')
              .textContent = 'Web NFC not supported on this device/browser.';
      document.getElementById('writeBtn').disabled = true;
    }

    // Use NDEFReader instead of navigator.nfc
    document.getElementById('writeBtn').onclick = async () => {
      try {
        const ndef = new NDEFReader();
        // You can either pass a simple string:
        await ndef.write(val);
        // Or a record:
        // await ndef.write({
        //   records: [{ recordType: 'text', data: val }]
        // });
        alert('✅ Written: ' + val);
      } catch (e) {
        alert('❌ NFC write failed:\n' + e);
      }
    };
  </script>
</body>
</html>
